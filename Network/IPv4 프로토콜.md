#### IPv4
- 우리가 일반적으로 IP주소라고 부르는 것
- 처음 IP주소는  낭비가 심했다.
- MAC주소는 6바이트였는데 IP주소는 4바이트고 10진수로 표현된다 IP주소는 192.168.0.0 이런식으로 표현되는데 한 구역당 1바이트가 된다.(1바이트는 8비트이므로 255까지) 

#### IPv4가 하는 일
- 네트워크 상에서 데이터를 교환하기 위한 포로토콜
- 데이터가 정확하게 전달될 것을 보장하지 않음
- 중복된 패킷 전달 or 패킷 순서를 잘못 전달 할 가능성도 있다. (악의적으로 이용되면 Dos 공격이 됨)
- 데이터의 정확하고 순차적인 전달은 그보다 상위 프로토콜인 TCP(4계층에서) 보장한다.

#### 예전의 IPv4 -Classful IP
예전의 IP 주소는 A클래스, B클래스, C클래스, D클래스, E클래스로 나눠서 네트워크로 구분했다.
A클래스는 0.0.0.0 ~ 127.255.255.255 로 맨 앞 0이 네트워크 대역을 구별했고 (첫번째필드)
B클래스는 128.0.0.0 ~ 191.255.255.255 로 맨 앞 10이 네트워크 대역을 구별 (두번째필드)
C는 192.0.0.0~ 223~~~ 110 (세번째 필드)
D는 224.0.0.0~ 239~~~ 앞의 1110이 네트워크 대역을 구별

> [!NOTE]
> 예전의 IPv4에서 A클래스라면 대역폭은 127개밖에 없지만 그 안에 올 수 있는 컴퓨터의 대수가 1600만대였다. 그래서 이런경우에 낭비가 너무 심했다.

#### 현재의 IPv4 - Classless IP
- 하나의 큰 네트워크를 여러개의 작은 네트워크로 쪼개서 씀
- 예전의 IPv4는 필드 단위로 네트워크 대역을 구분했다면 지금은 낭비되지 않도록 원하는 곳에서 짜름.
- 예전에는 . 을 기준으로 구분해서 192.168.0.1 이었으면 192 / 168 / 0 / 1 이렇게 

### IPv4 프로토콜의 구조
|             |                            |                       |                                 |     |
| ----------- | -------------------------- | --------------------- | ------------------------------- | --- |
| Byte Offset | 0                          | 1                     | 2                               | 3   |
| 0           | Version,IHL(Header Length) | Type of service (TOS) | Total Length                    | -   |
| 4           | Identification             | -                     | IP Flags x D M, Fragment Offset | -   |
| 8           | Time To Live(TTL)          | Protocol              | Header Checksum                 | -   |
| 12          | Source Address             | -                     | -                               | -   |
| 16          | Destination Address        | -                     | -                               | -   |
| 20          | IP Option                  | -                     | -                               | -   |

**Version** : IP 프로토콜의 버전. 4나 6만 아는데 4만 온다고 생각하면 된다. IPv6은 아예 구조가 다르다.
**IHL** : 프로토콜의 헤더의 길이고 보통 20이다. IP Option은 거의 안 붙는다. 하지만 20을 넣을 수 없으니까 4를 나눈 5라고 쓴다.  Version과 IHL은 4,5 가 온다고 보면 된다.
**Type of Service (TOS)** : 서비스의 형식을 쓰지만 요즘은 사용하지 않아 0 으로 비운다.
**Total Length** : 데이터의 전체의 길이
**Identification, IP Flag, Fragment Offset** : 데이터를 큰 것을 보낼 때 잘게 잘라서 보내는데 이것을 알아볼 수 있게 하는 값. identification은 쪼개진 데이터에 아이디를 부여하여 합쳐질 수 있도록 도와줌. IP Flags 는 3비트로 되어있고 첫 번 째 값은 안 쓴다 (x). 두 번 째(Dont fragment)는 데이터를 안 쪼개서 보내겠다는 뜻 (이것도 안 쓴다)
와 세 번 째 (M)는 조각화를 보낼 때 뒤에 데이터가 더 있다고 1로 알려주는 것. Fragment Offset은 13비트로 데이터를 복구 할 때 데이터 순서가 있기에 순서를 알아볼 수 있게 Offset을 지정. 시작지점에서 떨어진 값 만큼 Offset을 지정한다.
**TTL** : 네트워크 데이터가 잘못 보낼 때 무한루프가 일어날 수 있기에 데이터가 살아있는 시간을 정한다. 라우터 장비를 이동 할 때 마다 1씩 준다.
**Protocol** : 이더넷의 똑같은 부분. 상위 프로토콜이 뭔지 알려준다. ICMP(3계층, 1), TCP(4계층, 0 6), UDP(4계층 )
**Header Checksum** : 헤더의 길이를 비교하여 오류가 있는지 없는지 확인

#### IPv4 조각화
IPv4를 캡슐화하여 보낼 때 MTU(최대 전송 단위)가 네트워크 장비들마다 설정이 되어있다. 보통 1500바이트이고 이 장비를 통하여 내가 만든 패킷이 전달되어야 하므로 내가 보낼 데이터가 1500바이트보다 크면 IPv4 프로토콜에서 데이터를 잘게 쪼개는 작업을 해야하고 이걸 **조각화**라고 한다.
ex)
IPv4 프로토콜 + Data 가 11920 bytes를 보낼려고 하고 MTU가 3300byte면 한 번에 3280까지밖에 못 보낸다. (IPv4의 헤더가 보통 20바이트이므로) 

|     |        |      |
| --- | ------ | ---- |
| MF  | Offset | Data |
| 1   | 0      | 3280 |

|     |        |      |
| --- | ------ | ---- |
| MF  | Offset | Data |
| 1   | 410    | 3280 |

|     |        |      |
| --- | ------ | ---- |
| MF  | Offset | Data |
| 1   | 820    | 3280 |

|     |        |      |
| --- | ------ | ---- |
| MF  | Offset | Data |
| 0   | 1230   | 2140 |

Offset은 Data에서 8로 나눈다.

[[3계층 데이터링크]]
