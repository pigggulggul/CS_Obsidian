#### 3계층 프로토콜
[[ARP 프로토콜]], [[IPv4 프로토콜]], IPv6 프로토콜, [[ICMP 프로토콜]]
#### 3계층에서 하는 일
- 서로 다른 LAN 대역들을 연결시켜주는 역할을 한다. LAN과 LAN을 연결하는것이 WAN, 3계층의 역할이다.  3계층의 대표적인 장비가 Router이다. 스위치라는 2계층 장비만으로는 서로 다른 네트워크 대역으로 만들고 통신할 수 없다. 즉 멀리있는곳으로 가기 위해선 3계층이 필요하다.  
- 즉 네트워크 간의 통신을 가능하게 해주는 계층. ->라우팅
- 단편화도 여기에서 이루어진다.

#### MAC주소 대신 IP를 쓰는 이유
- MAC 주소는 고유한 주소인데 굉장히 많은 호스트가 있고 모든 네트워크의 MAC 주소를 하나의 컴퓨터가 알기는 매우 어렵다.
- 도달 경로를 파악하기 어렵다. MAC 주소는 주민번호로 비유가 많이 되는데 주민번호를 안다고 택배를 보내기는 어렵다. 도달 경로를 파악할만한 주소가 있어야지 택배를 올바르게 보낼 수 있다. (라우팅 어려움)
- 그래서 같은 LAN에서 통신을 할 때에도 IP 주소가 MAC 주소보다 먼저 활용이 된다.
- MAC 주소는 수신인, 발신인. IP 주소는 수신 주소, 발신 주소이다.

#### IP의 두 가지 주요 기능
- IP 주소 지정 - IP 주소를 이용하여 수신지와 송신지를 지정
- 단편화 - 패킷을 MTU 이하로 쪼개어 유지하는것. MTU 크기 이하로 단편화된 패킷들은 목적지에서 재조합
- 네트워크 주소와 호스트 주소가 있다 (MAC주소와 달리 주소들의 길이가 동적이다)

##### ipconfig를 쳤을 때 나오는 주소
- IPv4 주소
	- 현재 PC에 할당된 IP 주소. IPv4 주소의 경우 멀리있는곳이랑 통신 할 때 IP 주소만 있는게 아니라 서브넷 마스크, 게이트웨이 주소가 추가적으로 필요함.
- 서브넷 마스크
	- IP주소에서 네트워크 아이디의 길이를 나타내는 것. 네트워크 대역을 어디서 구분하는지 지정한 값. 그래서 IP 주소는 항상 서브넷 마스크와 같이 씀. IP와 서브넷 마스크를 보고 어디까지가 네트워크 아이디고 어디서부터 호스트 아이디인지 알 수 있다.
- 게이트웨이 
	- 외부와 통신할 때 사용하는 네트워크의 출입구

#### IPv4와 IPv6
1. **주소 길이:**
	- **IPv4:** 32비트, 보통 "x.x.x.x" 형식으로 표기됩니다. 192.168.0.1과 같은 형태입니다. 약 42억 개의 고유한 주소를 생성.
	- **IPv6:** 128비트, "x:x:x:x:x:x:x:x" 형식으로 표기되고 한 자리당 4개의 16진수로 이루어져있다. 거의 무한한 주소 공간.
2. **주소 고갈 문제:**
	- **IPv4:** 전세계적으로 IPv4 주소 할당이 빠르게 소진, 이로 인해 주소 할당에 대한 복잡한 과정과 NAT(Network Address Translation)과 같은 중간 계층 기술이 필요.
	- **IPv6:** IPv6는 주소 고갈 문제를 해결하기 위해 개발. 그 결과, 무한히 많은 고유한 주소를 생성할 수 있어, 주소 고갈 문제를 극복.
3. **보안 및 인증:**
	- **IPv4:** 추가적인 계층 및 프로토콜. 일부 기능은 별도로 구현.
	- **IPv6:** 내장된 보안 기능과 IPsec (Internet Protocol Security)를 지원. 이로써 데이터 무결성, 기밀성 및 인증을 강화.
4. **헤더 구조:**
	- **IPv4:** 단순, 라우팅 및 플래그 관련 정보를 포함.
	- **IPv6:** 복잡, 확장 헤더 옵션을 통해 다양한 기능을 지원. 기본적으론 확장 헤더, 홉 제한(TTL), 송신지와 수신지 IP 주소가 있다.
5. **지원 및 채택:**
	- **IPv4:** 오랜 기간동안 사용, 현재도 널리 사용. 그러나 IPv4 주소의 고갈로 인해 IPv6로의 전환이 진행 중.
	- **IPv6:** IPv6는 미래의 인터넷 환경을 준비하기 위한 중요한 기술, 많은 기업과 인터넷 서비스 제공업체(ISP)가 IPv6를 채택.
#### IPv4가 계속 사용되는 이유
1. **레거시 시스템 및 장비:** 많은 레거시 시스템과 네트워크 장비가 IPv4를 사용하고 있으며, IPv6를 지원하지 않거나 호환성 문제가 있는 경우가 있음. 이로 인해 IPv6로의 전환이 어려움.
    
2. **IPv4 주소 고갈 문제:** IPv4 주소는 대부분 소진되었으며, 새로운 IPv4 주소 할당은 제한. 그러나 기존의 IPv4 주소 체계는 아직까지 네트워크에서 사용, 주소 고갈 문제를 해결하려면 추가적인 대책이 필요.
    
3. **IPv6 전환의 복잡성:** IPv6로의 전환은 기존 네트워크 및 서비스 제공 업체에 대한 비용과 노력이 필요. 네트워크를 IPv6로 업그레이드하고 호환성을 유지하려면 적절한 계획과 시간 필요.
    
4. **네트워크 전반적인 안정성:** IPv4는 오랜 기간 동안 사용되어 왔으며, 많은 네트워크와 서비스가 익숙. IPv6로의 전환은 새로운 기술과 프로토콜을 도입하므로  안정성과 호환성을 확인해야 함.
    
5. **네트워크 운영자와 관리자의 역량:** IPv6 전환은 네트워크 운영자와 관리자의 역량과 노력이 필요. 

IPv6의 중요성과 이점은 인식되고 있으며, 많은 조직과 서비스 제공 업체가 IPv6를 도입하고 있습니다. 하지만 전환은 시간이 걸리며, IPv4와 IPv6가 동시에 사용되는 과도기적인 단계가 계속되고 있습니다. 미래에는 IPv6가 더 널리 채택될 것으로 예상되지만, 기존 IPv4 인프라와의 호환성 유지와 관련된 과제도 여전히 존재합니다.

#### IP주소와 MAC주소
- IP (Internet Protocol) : 네트워크 계층 (3계층)에서 사용. 라우팅 및 패킷 전달 할 때 사용, 고유하며 계층적인 주소 체계. 다른 네트워크와 통신하고 패킷을 라우팅. IP 주소는 Host에 대한 식별자이다. IP는 IPv4와 IPv6가 있다.
- MAC : 데이터 링크 계층 (2계층)에서 사용됩니다. MAC 주소는 로컬 네트워크에서만 유효, 네트워크 인터페이스 카드 (NIC)에 고유하게 할당. 같은 LAN 안에서 데이터 프레임을 전송하고 받습니다.
- IP의 예 : 대한민국의 행정체계 - 네트워크, 개인 - 호스트, <- 식별 - IP주소.
#### 왜 로컬네트워크에서 MAC 주소를 사용하는 걸까
- IP 주소로만 통신하면 안 되는 이유
	- 랜선을 찾아가는 라우팅 기법은 패킷에 포함된 IP Address(즉, 회선의 위치)를 추적해서 최단 경로를 선택해 가게 되어 있다. IP Address는 논리적인 주소이기 때문에 이 IP에서 목적지 네트워크를 추적해서 패킷을 보낸 뒤 그곳에서 그 IP에 등록된 MAC Address로 주소가 변환되어 그 컴퓨터로 패킷을 전송하게 된다. (결론 : IP는 최적의 경로를 찾아주는 라우팅을 하기 위한 주소이고 실질적인 통신은 MAC 주소로 한다!)
	- 예시 : 주민번호 = MAC 주소, 이름 = MAC에 매핑되는 IP 주소, 별명은 = IP 주소와 매핑되는 호스트 이름. 일상에서 누구를 부를 때 주민번호로 부르지x,. 불편하고 외우기 힘듬. 동창을 만나면 별명(DNS)만 기억나는 경우가 있음.    
- IP 주소만으로는 네트워크의 주소를 완전하게 알 수는 없다.
	- IP 주소는 논리적인 주소이며, 라우팅을 통해 특정 네트워크와 호스트를 식별하는 데 사용됩니다. 그러나 IP 주소 자체는 해당 네트워크의 위치 정보를 알려주지 않습니다. IP는 네트워크 주소 부분과 호스트 주소 부분으로 나뉨. 
		- 네트워크 주소 : IP 주소에서 네트워크를 식별하는 데 사용.
		- 호스트 주소 : 특정 네트워크 내에서 호스트를 식별하는 데 사용.
		- 사용자가 호스트의 IP 주소만으로 해당 호스트의 물리적인 주소를 파악하기 어렵다. ARP 이용
결국 실질적인 통신은 바꿀 수 없는 MAC 주소를 통해서 하고 논리적인 IP 주소는 라우팅(최적 경로 찾기)를 위한 주소이다.


#### 클래스풀 주소 체계
- A 클래스의 범위 : 맨 앞의 0이 고정이라 0.0.0.0 ~ 127.255.255.255
- B 클래스의 범위 : 맨 앞의 10이 고정이라 128.0.0.0 ~ 191.255.255.255
- C 클래스의 범위 : 맨 앞의 110이 고정이라 192.0.0.0 ~ 223.255.255.255
- ex) 172.16.12.45가 있으면 172.16이 네트워크 주소가 된다. 이 때 호스트 주소가 모두 0이면 네트워크 주소를 나타내고(172.16.0.0) 호스트 주소가 모두 1이면 브로드캐스트 주소를 나타낸다(172.16.255.255)
- **클래스풀 주소 체계는 오늘날 사용하지 않는다. (클래스의 사용으로 IP의 낭비)**

#### 클래스리스 주소 체계
- 클래스풀 주소 체계보다 더 정교히 네트워크를 나누는 방법
- 오늘날 주로 사용하는 방식
- 네트워크와 호스트를 구분하기 위해 서브넷 마스크 이용
#### 서브넷 마스크
- IP 주소 상에서 네트워크 주소는 1, 호스트 주소는 0으로 이루어진 비트열
- Classful한 네트워크 대역을 나눠주는데 사용하는 값. 특정 장비를 식별하는 호스트ID와 장비가 속한 네트워크를 식별하는 네트워크ID가 있음
- 어디까지가 네트워크 대역을 구분하는데 사용하고 어디서부터 호스트를 구분하는데 사용하는지 지정
- 서브넷 마스크와 IP 주소의 비트 AND 연산 -> 네트워크 주소
- 2진수로 표기했을 때 1로 시작, 연속된 1로 구성되어있어서 1과 1사이에는 0이 올 수 없다. 한 번 0이 오면 끝까지 0
- 255.255.255.0 -> 11111111.11111111.11111111.00000000 (C클래스)
- 255.255.0.0 -> 11111111.11111111.00000000.00000000 (B클래스)
- 255.0.0.0 -> 11111111.00000000.00000000.00000000 (A클래스)

#### 사설 IP와 공인 IP
- 사설IP와 공인IP가 현재 사용하는 IPv4의 개념. Classless와 같이 사용
- 공인 IP : 인터넷 세상에서 사용하는 IP주소
- 사설 IP : 같은 네트워크 대역에서 사용하는 IP주소
##### 사설IP와 공인IP로 부족한 IP문제에 통신하는 방법
사설 IP를 사용하는 장비들이 네트워크 통신 할 때 공인 IP로 바꿔서 인터넷과 통신한다. 강의실 -> 네이버로 갈 때 공인 IP 하나로 바껴서 간다. 그래서 외부에서 볼 때 (네이버 ->강의실 ) 구분이 되지 않는다. 공유기에 할당된 IP만 보이기 때문에 공유기 측에서 요청을 보낸 기기를 찾는다. **사설 IP에서 공인 IP로 보내주는것을 NAT**라고 한다.  NAT는 특정 아이피를 다른 특정 아이피로 바꾸는 것. 그래서 사설 -> 사설, 공인 -> 공인으로도 바꿀 수 있다.
- 외부에서 통신 할 때 사설 네트워크 대역이 없는것처럼 보임 (네이버가 30대의 기기가 있는 강의장을 볼 때 공유기 1대로 보임)
- 각자 인터넷을 얽히지않고 따로 할 수 있는건 공유기가 처리해서임. 공유기를 타고 WAN 대역으로 나갈 때 NAT 테이블에 기록하고 응답이 왔을 때 NAT 테이블을 보고 대상한테 전달
- 나간 적 없는 패킷이 응답으로 들어오면 공유기가 받고 사설에 전달하지 않고 끝
- 내부(사설 네트워크)에 특정 웹 서버가 있는 경우 공유기가 받고 응답을 주지 않기 때문에 **서버의 경우 공인 IP를 씀 or 공유기에 추가 작업을 함(포트포워딩 : 4계층)
- 공인 IP 하나당 사설 네트워크 대역이 따로 생긴거라서 IP 하나당 0.0.0.0 ~  255.255.255.255 가 생긴 샘. 이래서 부족현상이 어느정도 해결 됨.

#### 특수한 IP 주소
- 0.0.0.0 : 나머지 모든 IP
- 127.0.0.1 : 자기 자신을 뜻하는 주소
- 게이트웨이 주소 : 네트워크 대역에서 쓸 수 있는 IP 중 가장 작거나 가장 큰 IP 주소. 외부 세상으로 나가는 문. IP를 설정 할 때 외부세상으로 나가는 문의 위치를 알려주는 것


### 데이트 전송 과정
이더넷의 크기 : 최소바이트 60바이트, 최대바이트 1512바이트

#### [[데이터 통신]]


[[MAC, IP, Port 번호 식별자]]
[[4계층 데이터링크]]
[[네트워크 모델 ( TCP, IP )]]
[[DNS]]
