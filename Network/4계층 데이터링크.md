#### 4계층 프로토콜
포트번호, [[UDP 프로토콜]], [[TCP 프로토콜]]

#### 전송계층의 역할
- 네트워크 계층의 신뢰성/연결성 확립
- 응용 계층의 어플리케이션 프로세스 식별 : 포트
전송 계층은 네트워크 계층의 위에 있고 응용 계층 아래에 있다. 전송 계층은 네트워크 계층의 IP 프로토콜의 한계를 극복하는 계층이자 응용 계층의 어플리케이션 프로세스를 식별해주는 역할.  
#### 4계층에서 하는 일
송신자의 프로세스와 수신자의 프로세스를 연결하는 통신 서비스. 내 메모리에서 동작중인 프로그램(프로세스)과 상대방 컴퓨터에서 동작중인 프로그램을 연결하기 위한 계층. 4계층엔 TCP 와 UDP 프로토콜이 있다.

UDP : 비 연결지향형 프로토콜. 연결을 하든 말든 데이터를 던진다.
TCP : 연결지향형 프로토콜. 연결이 되는지 확인하고 연결이 됐으면 데이터를 던진다.

#### 포트의 사용
A와 B가 정보를 주고 받는데 A가 B에게 이미지 데이터를 전송한다. B는 웹 브라우저, 게임, 메신저를 동시에 실행중이다. A가 사진을 보내면 B가 아래 계층에서 하나씩 올라가면서 B에 도달한다. 웹브라우저, 게임, 메신저 중 어느 프로세스에게 메시지를 전달해야할지에 대한 정보도 있어야한다. 네트워크 계층은 IP를 이용하여 호스트가 누구인지까지 알 수 있다. B까지 도착하면 어느 프로세스에 줘야할지 3계층에서는 알 수 없기 떄문에 전송 계층에서 포트를 통해 식별해준다. 전송 계층의 포트번호를 토대로 이미지에 해당하는 포트로 전송해준다.
### 포트
어플리케이션 프로세스를 식별해주는 고유한 문자열
- 포트 번호는 16비트로 표현 가능(65536개)
- 포트 범위 : 0번부터 65535번 까지
#### 포트 번호
내 컴퓨터에서 사용하는 특정 프로그램이 사용하는 주소.
프로그램 하나가 포트번호 하나 사용 가능
A가 100번 포트 사용중이면 B는 다른 포트를 사용해야한다. 하지만 내 포트번호 하나는 하나의 프로그램만 실행 가능하지만 상대방 컴퓨터의 여러 프로그램들은 다 내 포트번호 하나랑 연결이 가능.

#### 포트번호의 종류
- Well-Known 포트 : 잘 알려진 포트. 웹이란 프로그램을 이용 할 땐 웹 브라우저라는 프로그램을 사용하는데 웹 서버 프로그램이랑 서로 연결이 된다. 이 때 웹 서버가 사용하는 포트번호가 80번. 0~1024번까지 (서버가 사용)

| 서비스 이름 | 포트 번호    |
| ------ | -------- |
| FTP    | 20번, 21번 |
| SSH    | 22번      |
| TELNET | 23번      |
| DNS    | 53번      |
| DHCP   | 67번, 68번 |
| TFTP   | 69번      |
| HTTP   | 80번      |
| HTTPS  | 443번     |


- 등록된(Registered) 포트 :  조금 유명한 포트. 오라클 DB 서버 - 1521번, MySQL서버 - 3306, MS 원격 데스크탑 - 3389번 (DB등이 사용)
- 동적(Dynamic) 포트 : 우리들이 사용하는 포트번호. 49152 ~ 65535 (클라이언트가 사용 )

우리가 크롬을 통하여 네이버라는 웹 서버와 연결이 될 때 시작 포트번호중에서 아무거나(49152)와 네이버(80)가 연결이 된다. 결국 인터넷을 사용하면 포트번호 쓰고 3계층주소 IP주소를 쓰고 2계층주소 MAC 주소를 사용한다.

- 요청을 보낼때는 어떤 어플리케이션으로부터 출발합니다(출발지 포트) 어떤 어플리케이션 프로세스를 식별하기 위한 정보입니다를 명시해야하고 응답도 반대로 있어야한다.(목적지 포트). 그래서 클라이언트로 동작하는 프로그램(웹 브라우저 등)도 포트가 할당되는데 클라이언트로 사용되는 이러한 포트번호는 동적포트를 받고 동적포트에서 랜덤으로 할당받는다. (리소스 모니터를 이용해서 포트를 확인 할 수 있다)
#### NAT
- NAT는 공인 IP 주소와 사설 IP 주소 간의 변화 기능이 있는데 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유 가능한데 여기서 포트를 활용한다
- NAT(Network Address Translation)은 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재 기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술을 말함.
- 특정 IP주소에 특정 포트번호로 가는 주소를 다른 IP주소에 다른 포트번호로 바꿔주는것.
- 패킷에 변화가 생기기 때문에 IP나 TCP/UDP의 체크섬(checksum)도 다시 계산되어 재기록해야 함.
- NAT를 이용하는 이유는 사설 네트워크에 속한 여러 개의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속하기 위함.
- 사설 네트워크(IP) 대역의 PC, 노트북등이 통신 할 때 공인 IP가 되어 통신함. NAT 테이블 안에 장치의 요청을 기록하고 들어올 때 요청에 대한 응답이 있어야지만 접근함 .

![](https://i.imgur.com/gLEGI7X.png)

#### 포트포워딩
포트포워딩은 특정 IP 주소와 포트 번호의 통신 요청을 특정 다른 IP와 포트 번호로 넘겨주는 네트워크 주소 변환(NAT)의 응용이다. 서버가 사설 네트워크 대역에 있을 때 그 네트워크의 대역을 설정하는 공유기, 라우터 등 3계층 장비에서 제공해주는 기능. 
ex) 사설 IP 대역에 있는 컴퓨터가 보이지 않는 네트워크 대역의 컴퓨터로 직접 통신을 하고 싶을 때 (먼저 들어가고 싶을 때) 네트워크 대역이 있는 공인 IP의 특정 포트로 보내고 그 공유기가 포트포워딩 설정을 해야한다. 그럼 특정 포트로 들어온 요청을 다른 특정 IP(사설 IP 등)의 특정 포트로 전송(대신 전달)


[[MAC, IP, Port 번호 식별자]]
[[네트워크 모델 ( TCP, IP )]]